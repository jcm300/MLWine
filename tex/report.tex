\documentclass{article}
\usepackage[a4paper, top=3cm, left=3cm, right=2.5cm, bottom=2.5cm]{geometry}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{float}
\usepackage{fancyvrb}
\usepackage{amsmath}
\usepackage{ragged2e}
\usepackage[portuguese]{babel}
\usepackage{color}

\begin{document}

\title{\Huge
       \textbf{UNIVERSIDADE DO MINHO}\\
       \vspace*{3cm}
       \huge
       \textbf{\textit{Machine Learning de Qualidade de Vinhos}\\
       \vspace*{3cm}
       \large
       Mestrado Integrado de Engenharia Informática\\
       \vspace*{2cm}
       Sistemas de Representação de Conhecimento e Raciocínio\\
       (2ºSemestre/2017-2018)
       \vspace*{\fill}}
}

\author{\hspace*{-5cm}Número\hspace*{1cm}Nome do(s) Autor(es)\hspace*{\fill}\\
        \hspace*{-5cm}a78468\hspace*{1cm}João Vieira\hspace*{\fill}\\
        \hspace*{-5cm}a78821\hspace*{1cm}José Martins\hspace*{\fill}\\
        \hspace*{-5cm}a77049\hspace*{1cm}Miguel Quaresma\hspace*{\fill}\\
        \hspace*{-5cm}a77689\hspace*{1cm}Simão Barbosa\hspace*{\fill}}

\date{\hspace*{\fill}Braga, Portugal\hspace*{1cm}\\
      \hspace*{\fill}\today\hspace*{1cm}}

\maketitle

\newpage

\justify

\vspace*{\fill}
\section{Resumo}
As redes neuronais artificiais são técnicas computacionais que apresentam um modelo matemático inspirado no cérebro (estrutura neuronal) de organismos inteligentes. Estas redes são capazes de realizar aprendizagem e de adquirirem conhecimento através da experiência com dados recebidos.\\
Neste projeto, o objetivo passa por criar uma rede neuronal capaz de estudar e aprender tendo em conta dados relativos a dois tipos de vinhos, branco e tinto, considerando como \textit{input} informações relativas dos vinhos como o álcool ou o pH, e sendo o \textit{output} a qualidade do mesmo.\\
Este relatório mostra e explica o processo de desenvolvimento de um programa utilizando a linguagem de programação $R$ capaz de efetuar o objetivo pretendido, com um valor de erro bastante pequeno.  

\vspace*{\fill}

\newpage

\vspace*{\fill}
\tableofcontents
\vspace*{\fill}

\newpage

\vspace*{\fill}
\section{Introdução}
{\color{red}TODO}
\vspace*{\fill}

\newpage

\section{Descrição do Trabalho e Análise de Resultados}

Como os dados a serem tratados neste projeto são dois \textit{datasets} sobre vinhos (um de vinho branco e outro de vinho tinto) com as mesmas características, começamos por ler os mesmos e junta-los num só, realizando após a junção um sorteio da ordem de cada linha.

\begin{verbatim}
# leitura dos dados a processar
dadosRed <- read.csv(".../winequality-red.csv",header=TRUE,sep=";",dec=".")
dadosWhite <- read.csv(".../winequality-white.csv",header=TRUE,sep=";",dec=".")

# junção dos dados
dados <- rbind(dadosRed, dadosWhite)
\end{verbatim}

Após isto, avaliamos os dados e procedemos à normalização dos mesmos, sendo que o \textit{output} (quality) foi multiplicado por 0.1 de modo a tornar-se normalizado.

\begin{verbatim}
dadosR[,1:11] <- normalize(dadosR[,1:11], method="range", range=c(0,1))
dadosR[,12] <- dadosR[,12]*0.1
\end{verbatim}

Realizamos de seguida um teste aos dados de modo a saber quais os valores mais influentes no valor \textit{output}. Tendo em conta os resultados decidimos criar as seguintes fórmulas:

\begin{verbatim}
funcao <- quality ~ fixed.acidity+volatile.acidity+citric.acid+residual.sugar+chlorides+
                    free.sulfur.dioxide+total.sulfur.dioxide+density+pH+sulphates+alcohol
funcaoOpt <- quality ~ alcohol+volatile.acidity+sulphates+residual.sugar+total.sulfur.dioxide
funcaoOpt2 <- quality ~ alcohol+volatile.acidity+sulphates
\end{verbatim}

sendo que a primira (\texttt{funcao}) tem em conta todos os valores das caraterísticas dos vinhos presentes nos ficheiros de \textit{input}, a segunda (\texttt{funcaoOpt}) apenas 5 destes valores, e por último apenas temos em conta 3 deles (\texttt{funcaoOpt2}).\\
Após isso decidimos dividir os dados em duas partes, uma parte para treinar a rede neuronal (os primeiros 4500) e o resto para testar a rede neuronal treinada.
Por forma a descobrir a melhor rede neuronal, ou seja, a que obtém o menor erro com os dados de teste, é necessário realizar várias tentativas e verificações de resultados obtidos com as mesmas. O processo seguido por nós foi executado pela seguinte ordem:

\begin{itemize}
    \item Treinar a rede neuronal:\\
        \verb|rnaWine <- neuralnet(funcao, dadosTreino, lifesign=``full'', hidden = c(7,5), threshold = 0.01)|
    \item Preparar os dados de teste:\\ 
        \verb|dadosTeste1 <- subset(dadosTeste, select = c(``fixed.acidity'', ``volatile.acidity'', ``citric.acid'', ``residual.sugar'', ``chlorides'', ``free.sulfur.dioxide'', ``total.sulfur.dioxide'', ``density'', ``pH'', ``sulphates'', ``alcohol''))|
    \item Testar a rede:\\
        \verb|rnaWine1.resultados <- compute(rnaWine1,dadosTeste1)|
    \item Comparar resultados:\\
        \verb|resultados1 <- data.frame(atual = dadosTeste$quality, previsao = rnaWine1.resultados$net.result)|
    \item Arredondar os resultados:\\
        \verb|resultados1$previsao <- round(resultados1$previsao, digits=1)|
    \item Calcular o RMSE:\\
        \verb|rmse(c(dadosTeste$quality),c(resultados1$previsao))|
\end{itemize}

O arredondamento dos resultados é realizado com 1 casa decimal tendo em conta que o \textit{output} dos \textit{datasets} não toma o valor de 0 ou 1 (falso ou verdadeiro) mas sim um valor compreendido entre 0 e 10 (ou após serem normalizados de 0 a 1, de 0.1 em 0.1).\\
É também importante referir que como variamos a fórmula entre as várias tentativas na preparação de dados de teste os dados definidos mudam consoante a fórmula. É de notar também que durante os testes é variado o \textit{hidden} e o \textit{threshold} da rede neuronal, com o objetivo de obter os melhores resultados possíveis.
O \textit{hidden} é referente às camadas intermédias da rede neuronal, enquanto que a fórmula inserida define os neurónios de entrada e de saída.

\subsection{Tentativas}

\subsubsection{threshold=0.1}

\textbf{Com funcao}\\
Rede Neuronal : Erro\\
11 $\to$ 6 $\to$ 1 : 0.07857646844\\
11 $\to$ 3 $\to$ 3 $\to$ 1 : 0.07777579064\\
11 $\to$ 10 $\to$ 8 $\to$ 1 : 0.07716171911\\
11 $\to$ 7 $\to$ 4 $\to$ 1 : 0.07611629613\\
\\
\textbf{Com funcaoOpt}\\
Rede Neuronal : Erro\\
5 $\to$ 5 $\to$ 3 $\to$ 1 : 0.08027868335\\
\\
\textbf{Com funcaoOpt2}\\
Rede Neuronal : Erro\\
3 $\to$ 6 $\to$ 2 : 0.07958958319\\

\subsubsection{threshold=0.01}

\textbf{Com funcao}\\
Rede Neuronal : Erro\\
11 $\to$ 6 $\to$ 3 $\to$ 1 : 0.07598460693\\
11 $\to$ 7 $\to$ 4 $\to$ 1 : 0.07738852289\\
11 $\to$ 12 $\to$ 4 $\to$ 1 : 0.07732378969\\
11 $\to$ 5 $\to$ 3 $\to$ 1 : 0.0760833952\\
11 $\to$ 10 $\to$ 1 : 0.07528945978\\
11 $\to$ 8 $\to$ 7 $\to$ 1 : 0.09155639716\\
11 $\to$ 7 $\to$ 5 $\to$ 1 : 0.07595164896\\
\\
\textbf{Com funcaoOpt}\\
Rede Neuronal : Erro\\
5 $\to$ 6 $\to$ 2 $\to$ 1 : 0.07628058791\\
5 $\to$ 8 $\to$ 4 $\to$ 1 : 0.07761466391\\
5 $\to$ 4 $\to$ 1 : 0.07860832592\\
5 $\to$ 6 $\to$ 3 $\to$ 1 : 0.07719416045\\
5 $\to$ 6 $\to$ 5 $\to$ 1 : 0.07780797595\\
5 $\to$ 4 $\to$ 3 $\to$ 1 : 0.07784014795\\
5 $\to$ 4 $\to$ 2 $\to$ 1 : 0.07738852289\\
5 $\to$ 3 $\to$ 2 $\to$ 1 : 0.07835310341\\
5 $\to$ 4 $\to$ 5 $\to$ 4 $\to$ 1 : 0.07706431316\\
\\
\textbf{Com funcaoOpt2}\\
Rede Neuronal : Erro\\
3 $\to$ 4 $\to$ 1 : 0.07946365023\\
3 $\to$ 2 $\to$ 1 : 0.07999749621\\
3 $\to$ 2 $\to$ 2 $\to$ 1 : 0.07930595281\\
3 $\to$ 3 $\to$ 2 $\to$ 1 : 0.07984085322\\
3 $\to$ 4 $\to$ 3 $\to$ 1 : 0.07971531721\\
3 $\to$ 4 $\to$ 4 $\to$ 1 : 0.0796839023\\
3 $\to$ 5 $\to$ 1 : 0.0796839023\\
3 $\to$ 5 $\to$ 3 $\to$ 1 : 0.07996619216\\
3 $\to$ 2 $\to$ 3 $\to$ 2 $\to$ 1 : 0.07930595281\\
3 $\to$ 4 $\to$ 5 $\to$ 4 $\to$ 1 : 0.08015383307\\

O menor valor de erro conseguido foi obtido como esperado usando todas as caracteristicas dos vinhos, contudo, o erro não aumenta assim tão significantemente se se usar apenas as 5 principais caracteristicas. É de referir também que mesmo usando apenas 3 caraterísticas se consegue um valor para o erro obtido que não é assim tão diferente dos referidos anteriormente.\\
Desta forma, podemos concluir com isto que não usando todas as caraterísticas dos vinhos, ou seja, treinando uma rede neuronal de uma forma não tão complexa, consegue-se bom resultados e um nível de erro bastante pequeno.
Sendo assim, a melhor rede neuronal seria 11 $\to$ 7 $\to$ 5 $\to$ 1 com um erro de aproximadamente 7.595\% de a resposta dada pela rede ser errada. Contudo uma boa alternativa seria a rede 5 $\to$ 6 $\to$ 2 $\to$ 1 com um erro de aproximadamente 7.628\% de a resposta dada pela rede ser incorreta.

{\color{red}TODO}

\newpage

\vspace*{\fill}
\section{Conclusões e Sugestões}
Após várias tentativas de redes neuronais construídas, chegamos à conclusão de que não é de uma importância relevante usar todas as caracteristicas dos vinhos recebidas como \textit{input}, porque é possível verificar que o erro diminui pouco em relação a uma rede com as mais importantes caraterísticas (respetivamente, utilizando apenas 5 e 3 dados), e também porque o tempo de aprendizagem da rede neuronal utilizando todos os dados é muito superior, acabando por não compensar a diferença entre tempos tendo em conta a pequena diferença nos erros verificada. Uma possível melhoria para o programa passaria por continuar a testar novas redes neuronais, até criar um programa que em ciclo teste por si só as diferentes redes neuronais.
\vspace*{\fill}

\newpage

\end{document}
